---
moreauto: true
procversion: 1.0.0
procname: modularity_3study
proctype: modularity_3study_v1

inputs:
  default:
    container_path: baxpr-fmri_modularity-master-v1.0.0.simg
    container_source: shub://baxpr/fmri_modularity:v1.0.0
    extraflags: ""
  xnat:
    scans:
      - name: scan_fmri
        types: 'Funct-Run1,Resting State,Rest'
        needs_qc: False
        resources:
          - resource: NIFTI
            fmatch: '*.nii.gz'
            fcount: 1
            ftype: FILE
            fdest: fmri.nii.gz
            varname: func_file

    assessors:
      - name: assr_magm
        proctypes: MAGM_Coreg_Normalize_v2
        needs_qc: False
        resources:
          - resource: INIT_COREG_MAT
            ftype: FILE
            fdest: coreg_mat.txt
            varname: coregmat_file
          - resource: FWD_DEF
            ftype: FILE
            fdest: y_deffwd.nii.gz
            varname: deffwd_file
          - resource: COREG_T1
            ftype: FILE
            fdest: ct1.nii.gz
            varname: ct1_file
          - resource: W_GRAY
            ftype: FILE
            fdest: wgm.nii.gz
            varname: wgm_file
          - resource: W_SEG
            ftype: FILE
            fdest: wcseg.nii.gz
            varname: wcseg_file

    attrs:
      - varname: project
        object: session
        attr: project
      - varname: subject
        object: session
        attr: subject_label
      - varname: session
        object: session
        attr: label
      - varname: scan
        object: scan
        attr: ID
        ref: scan_fmri

outputs:
  - path: fmri_conncalc.pdf
    type: FILE
    resource: PDF
  - path: FD.txt
    type: FILE
    resource: FD
  - path: DVARS.txt
    type: FILE
    resource: DVARS
  - path: badvols.txt
    type: FILE
    resource: BADVOLS
  - path: confounds_keepgm_noscrub.txt
    type: FILE
    resource: CONFOUNDS_KEEPGM_NOSCRUB
  - path: connectivity_matrix_R_keepgm_noscrub.csv
    type: FILE
    resource: CONNMAT_R_KEEPGM_NOSCRUB
  - path: filtered_keepgm_noscrub.nii.gz
    type: FILE
    resource: FILTERED_KEEPGM_NOSCRUB
  - path: roi_timeseries_keepgm_noscrub.csv
    type: FILE
    resource: ROI_DATA_KEEPGM_NOSCRUB
  - path: stats_keepgm_noscrub.txt
    type: FILE
    resource: STATS_KEEPGM_NOSCRUB
  - path: Zmap_keepgm_noscrub.nii.gz
    type: FILE
    resource: ZMAP_KEEPGM_NOSCRUB
  - path: sZmap_keepgm_noscrub.nii.gz
    type: FILE
    resource: SZMAP_KEEPGM_NOSCRUB
  - path: confounds_keepgm_scrub.txt
    type: FILE
    resource: CONFOUNDS_KEEPGM_SCRUB
  - path: connectivity_matrix_R_keepgm_scrub.csv
    type: FILE
    resource: CONNMAT_R_KEEPGM_SCRUB
  - path: filtered_keepgm_scrub.nii.gz
    type: FILE
    resource: FILTERED_KEEPGM_SCRUB
  - path: roi_timeseries_keepgm_scrub.csv
    type: FILE
    resource: ROI_DATA_KEEPGM_SCRUB
  - path: stats_keepgm_scrub.txt
    type: FILE
    resource: STATS_KEEPGM_SCRUB
  - path: Zmap_keepgm_scrub.nii.gz
    type: FILE
    resource: ZMAP_KEEPGM_SCRUB
  - path: sZmap_keepgm_scrub.nii.gz
    type: FILE
    resource: SZMAP_KEEPGM_SCRUB
  - path: confounds_removegm_noscrub.txt
    type: FILE
    resource: CONFOUNDS_REMOVEGM_NOSCRUB
  - path: connectivity_matrix_R_removegm_noscrub.csv
    type: FILE
    resource: CONNMAT_R_REMOVEGM_NOSCRUB
  - path: filtered_removegm_noscrub.nii.gz
    type: FILE
    resource: FILTERED_REMOVEGM_NOSCRUB
  - path: roi_timeseries_removegm_noscrub.csv
    type: FILE
    resource: ROI_DATA_REMOVEGM_NOSCRUB
  - path: stats_removegm_noscrub.txt
    type: FILE
    resource: STATS_REMOVEGM_NOSCRUB
  - path: Zmap_removegm_noscrub.nii.gz
    type: FILE
    resource: ZMAP_REMOVEGM_NOSCRUB
  - path: sZmap_removegm_noscrub.nii.gz
    type: FILE
    resource: SZMAP_REMOVEGM_NOSCRUB
  - path: confounds_removegm_scrub.txt
    type: FILE
    resource: CONFOUNDS_REMOVEGM_SCRUB
  - path: connectivity_matrix_R_removegm_scrub.csv
    type: FILE
    resource: CONNMAT_R_REMOVEGM_SCRUB
  - path: filtered_removegm_scrub.nii.gz
    type: FILE
    resource: FILTERED_REMOVEGM_SCRUB
  - path: roi_timeseries_removegm_scrub.csv
    type: FILE
    resource: ROI_DATA_REMOVEGM_SCRUB
  - path: stats_removegm_scrub.txt
    type: FILE
    resource: STATS_REMOVEGM_SCRUB
  - path: Zmap_removegm_scrub.nii.gz
    type: FILE
    resource: ZMAP_REMOVEGM_SCRUB
  - path: sZmap_removegm_scrub.nii.gz
    type: FILE
    resource: SZMAP_REMOVEGM_SCRUB
  - path: wmeanadfunc.nii.gz
    type: FILE
    resource: W_FUNC_MEAN
  - path: wadfunc.nii.gz
    type: FILE
    resource: W_FUNC
  - path: rwroi_labels.nii.gz
    type: FILE
    resource: ROI_LABELS
  - path: rp_adfunc.txt
    type: FILE
    resource: REALIGN_PARAMS
  - path: roi_snr.nii.gz
    type: FILE
    resource: ROI_SNR
  - path: roi_info.csv
    type: FILE
    resource: ROI_INFO
  - path: roi_labels.csv
    type: FILE
    resource: ROI_LABEL_INFO
  - path: params.csv
    type: FILE
    resource: PARAMS

command: >-
  singularity
  run
  --bind $INDIR:/INPUTS
  --bind $OUTDIR:/OUTPUTS
  "{container_path}"
  magick_path /usr/bin
  param_file "params_JSins.csv"
  wroi_file "rois_JSins.nii.gz"
  roi_file ''
  roiinfo_file "rois_JSins.csv"
  coregmat_file "{coregmat_file}"
  deffwd_file "{deffwd_file}"
  ct1_file "{ct1_file}"
  wgm_file "{wgm_file}"
  wcseg_file "{wcseg_file}"
  func_file "{func_file}"
  project "{project}"
  subject "{subject}"
  session "{session}"
  scan "{scan}"
  out_dir /OUTPUTS


attrs:
  xsitype: proc:genProcData
  walltime: '2:00:00'
  memory: 8192
  ppn: 1
jobtemplate: singularity_job_template.txt
